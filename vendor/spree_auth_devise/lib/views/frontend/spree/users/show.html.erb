<div id="my-account">
  <div class="my-account-left"> <!-- required for floating -->
    <!-- Nav tabs -->
    <ul class="nav nav-tabs tabs-left">
      <li class="<%= 'active' if params[:tab] == 'account_my_orders' or params[:tab] == nil %>"><a href="#account_my_orders" data-toggle="tab"><%= Spree.t(:my_orders) %></a></li>
      <li class="<%= 'active' if params[:tab] == 'account_summary' %>"><a href="#account_summary" data-toggle="tab">账户管理</a></li>
      <li class="<%= 'active' if params[:tab] == 'wishlist' %>"><a href="#wishlist" data-toggle="tab">我的收藏</a></li>
      <li class="<%= 'active' if params[:tab] == 'address' %>"><a href="#address" data-toggle="tab">地址管理</a></li>
    </ul>
  </div>

  <div class="my-account-right">
    <div class="tab-content">
      <!------------------------- Order ---------------------------------->
      <div class="tab-pane fade <%= 'active in' if params[:tab] == 'account_my_orders' or params[:tab] == nil %>" id="account_my_orders">
        <div class="account-order-list-wrapper">
          <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#order-tab-all" aria-controls="order-tab-all" role="tab" data-toggle="tab">所有订单</a></li>
            <li role="presentation"><a href="#order-tab-unpaied" aria-controls="order-tab-unpaied" role="tab" data-toggle="tab">待付款 </a></li>
            <li role="presentation"><a href="#order-tab-shipping" aria-controls="order-tab-shipping" role="tab" data-toggle="tab">待收货</a></li>
            <li role="presentation"><a href="#order-tab-unshipped" aria-controls="order-tab-unshipped" role="tab" data-toggle="tab">待发货</a></li>
          </ul>
          <div class="tab-content">
            <!-------------------------- 全部订单 -------------------------->
            <div role="tabpanel" class="tab-pane fade in active" id="order-tab-all">
              <div data-hook="account_my_orders" class="account_my_orders">
                <% if @orders.present? %>
                  <table class="table table-bordered account-order-table">
                    <thead class="active">
                      <tr class="text-center">
                        <th class="text-center">商品信息</th>
                        <th class="text-center" width="100px">单价（元）</th>
                        <th class="text-center" width="100px">数量</th>
                        <th class="text-center" width="80px"><%= Spree.t(:total) %></th>
                        <th class="text-center" width="100px">交易状态</th>
                        <th class="text-center" width="100px">操作</th>
                      </tr>
                    </thead>
                    <% @orders.each do |order| %>
                      <tbody><tr class="sep-row"></tr></tbody>
                      <tbody class="order-item-wrapper">
                        <tr>
                          <td class="order-number-wrapper" colspan="6">
                            <span class="order-date"><strong><%= l order.completed_at.to_date %></strong>&nbsp;&nbsp;</span>
                            <span class="order-number"><%= Spree::Order.human_attribute_name(:number) %>: <%= link_to order.number, order_url(order) %></span>
                          </td>
                        </tr>
                        <tr>

                          <td class="order-info" colspan="3">
                            <% order.line_items.each do |item| %>
                              <div class="order-product-item clearfix">
                                <div class="pull-left" data-hook="order_item_image">
                                  <% if item.variant.images.length == 0 %>
                                    <%= link_to small_image(item.variant.product), item.variant.product, class: 'account-order-image' %>
                                  <% else %>
                                    <%= link_to image_tag(item.variant.images.first.attachment.url(:small)), item.variant.product, class: 'account-order-image' %>
                                  <% end %>
                                </div>
                                <div class="order-item-desc pull-left" data-hook="order_item_description">
                                  <p class="product-name"><%= item.variant.product.name %></p>
                                  <p class="product-variant"><%= item.variant.options_text unless item.variant.option_values.empty? %></p>
                                </div>
                                <div data-hook="order_item_qty" class="text-center order-qty pull-right"><%= item.quantity %></div>
                                <div data-hook="order_item_price" class="text-center order-item-price pull-right"><span><%= item.single_money.to_html %></span></div>
                              </div>
                            <% end %>
                          </td>
                          <td class="text-center order-total"><%= order.display_total %></td>
                          <td class="text-center order-status">
                            <% if order.payment_state == 'paid' %>

                              <p class="order-shipment-state"><%= Spree.t("shipment_states.#{order.shipment_state}").titleize if order.shipment_state %></p>
                              <% if order.shipment_state != 'shipped' %>
                                <p><a href="" class="btn">查看单号</a></p> <!-- TODO -->
                              <% end %>

                            <% else  %>
                              <p class="order-payment-state"><%= Spree.t("payment_states.#{order.payment_state}").titleize if order.payment_state %></p>
                            <% end %>
                            <p class="hidden"><%= Spree.t("order_state.#{order.state}").titleize %></p>


                            <p><%= link_to '订单详情', order_url(order) %></p>
                          </td>
                          <td class="order-operations text-center">取消订单</td>

                        </tr>
                      </tbody>
                    <% end %>
                  </table>
                <% else %>
                  <div class="alert alert-info"><%= Spree.t(:you_have_no_orders_yet) %></div>
                <% end %>
                <br />
              </div>
            </div>

            <!-------------------------- 待付款 -------------------------->
            <div role="tabpanel" class="tab-pane fade" id="order-tab-unpaied">
              <div data-hook="account_my_orders" class="account_my_orders">
                <% if @orders.present? %>
                  <table class="table table-bordered account-order-table">
                    <thead class="active">
                      <tr class="text-center">
                        <th class="text-center">商品信息</th>
                        <th class="text-center" width="100px">单价（元）</th>
                        <th class="text-center" width="100px">数量</th>
                        <th class="text-center" width="80px"><%= Spree.t(:total) %></th>
                        <th class="text-center" width="100px">交易状态</th>
                        <th class="text-center" width="100px">操作</th>
                      </tr>
                    </thead>
                    <% @orders.each do |order| %>
                      <% if order.payment_state == 'balance_due' %>
                        <tbody><tr class="sep-row"></tr></tbody>
                        <tbody class="order-item-wrapper">
                          <tr>
                            <td class="order-number-wrapper" colspan="6">
                              <span class="order-date"><strong><%= l order.completed_at.to_date %></strong>&nbsp;&nbsp;</span>
                              <span class="order-number"><%= Spree::Order.human_attribute_name(:number) %>: <%= link_to order.number, order_url(order) %></span>
                            </td>
                          </tr>
                          <tr>

                            <td class="order-info" colspan="3">
                              <% order.line_items.each do |item| %>
                                <div class="order-product-item clearfix">
                                  <div class="pull-left" data-hook="order_item_image">
                                    <% if item.variant.images.length == 0 %>
                                      <%= link_to small_image(item.variant.product), item.variant.product, class: 'account-order-image' %>
                                    <% else %>
                                      <%= link_to image_tag(item.variant.images.first.attachment.url(:small)), item.variant.product, class: 'account-order-image' %>
                                    <% end %>
                                  </div>
                                  <div class="order-item-desc pull-left" data-hook="order_item_description">
                                    <p class="product-name"><%= item.variant.product.name %></p>
                                    <p class="product-variant"><%= item.variant.options_text unless item.variant.option_values.empty? %></p>
                                  </div>
                                  <div data-hook="order_item_qty" class="text-center order-qty pull-right"><%= item.quantity %></div>
                                  <div data-hook="order_item_price" class="text-center order-item-price pull-right"><span><%= item.single_money.to_html %></span></div>
                                </div>
                              <% end %>
                            </td>
                            <td class="text-center order-total"><%= order.display_total %></td>
                            <td class="text-center order-status">
                              <p class="hidden"><%= Spree.t("order_state.#{order.state}").titleize %></p>
                              <p class="order-payment-state"><%= Spree.t("payment_states.#{order.payment_state}").titleize if order.payment_state %></p>
                              <p><%= link_to '订单详情', order_url(order) %></p>
                            </td>
                            <td class="order-operations text-center">取消订单</td>

                          </tr>
                        </tbody>
                      <% end %>
                    <% end %>
                  </table>
                <% else %>
                  <div class="alert alert-info"><%= Spree.t(:you_have_no_orders_yet) %></div>
                <% end %>
                <br />
              </div>
            </div>

            <!-------------------------- 待收货 -------------------------->
            <div role="tabpanel" class="tab-pane fade" id="order-tab-shipping">
              <div data-hook="account_my_orders" class="account_my_orders">
                <% if @orders.present? %>
                  <table class="table table-bordered account-order-table">
                    <thead class="active">
                      <tr class="text-center">
                        <th class="text-center">商品信息</th>
                        <th class="text-center" width="100px">单价（元）</th>
                        <th class="text-center" width="100px">数量</th>
                        <th class="text-center" width="80px"><%= Spree.t(:total) %></th>
                        <th class="text-center" width="100px">交易状态</th>
                        <th class="text-center" width="100px">操作</th>
                      </tr>
                    </thead>
                    <% @orders.each do |order| %>
                      <% if order.shipment_state == 'shipped' %>
                        <tbody><tr class="sep-row"></tr></tbody>
                        <tbody class="order-item-wrapper">
                          <tr>
                            <td class="order-number-wrapper" colspan="6">
                              <span class="order-date"><strong><%= l order.completed_at.to_date %></strong>&nbsp;&nbsp;</span>
                              <span class="order-number"><%= Spree::Order.human_attribute_name(:number) %>: <%= link_to order.number, order_url(order) %></span>
                            </td>
                          </tr>
                          <tr>

                            <td class="order-info" colspan="3">
                              <% order.line_items.each do |item| %>
                                <div class="order-product-item clearfix">
                                  <div class="pull-left" data-hook="order_item_image">
                                    <% if item.variant.images.length == 0 %>
                                      <%= link_to small_image(item.variant.product), item.variant.product, class: 'account-order-image' %>
                                    <% else %>
                                      <%= link_to image_tag(item.variant.images.first.attachment.url(:small)), item.variant.product, class: 'account-order-image' %>
                                    <% end %>
                                  </div>
                                  <div class="order-item-desc pull-left" data-hook="order_item_description">
                                    <p class="product-name"><%= item.variant.product.name %></p>
                                    <p class="product-variant"><%= item.variant.options_text unless item.variant.option_values.empty? %></p>
                                  </div>
                                  <div data-hook="order_item_qty" class="text-center order-qty pull-right"><%= item.quantity %></div>
                                  <div data-hook="order_item_price" class="text-center order-item-price pull-right"><span><%= item.single_money.to_html %></span></div>
                                </div>
                              <% end %>
                            </td>
                            <td class="text-center order-total"><%= order.display_total %></td>
                            <td class="text-center order-status">
                              <p class="hidden"><%= Spree.t("order_state.#{order.state}").titleize %></p>
                              <p class="order-payment-state"><%= Spree.t("payment_states.#{order.payment_state}").titleize if order.payment_state %></p>
                              <p><%= link_to '订单详情', order_url(order) %></p>
                            </td>
                            <td class="order-operations text-center">取消订单</td>

                          </tr>
                        </tbody>
                      <% end %>
                    <% end %>
                  </table>
                <% else %>
                  <div class="alert alert-info"><%= Spree.t(:you_have_no_orders_yet) %></div>
                <% end %>
                <br />
              </div>
            </div>

            <!-------------------------- 待发货 -------------------------->
            <div role="tabpanel" class="tab-pane fade" id="order-tab-unshipped">
              <div data-hook="account_my_orders" class="account_my_orders">
                <% if @orders.present? %>
                  <table class="table table-bordered account-order-table">
                    <thead class="active">
                      <tr class="text-center">
                        <th class="text-center">商品信息</th>
                        <th class="text-center" width="100px">单价（元）</th>
                        <th class="text-center" width="100px">数量</th>
                        <th class="text-center" width="80px"><%= Spree.t(:total) %></th>
                        <th class="text-center" width="100px">交易状态</th>
                        <th class="text-center" width="100px">操作</th>
                      </tr>
                    </thead>
                    <% @orders.each do |order| %>
                      <% if order.shipment_state != 'shipped' and order.payment_state == 'paid' %>
                        <tbody><tr class="sep-row"></tr></tbody>
                        <tbody class="order-item-wrapper">
                          <tr>
                            <td class="order-number-wrapper" colspan="6">
                              <span class="order-date"><strong><%= l order.completed_at.to_date %></strong>&nbsp;&nbsp;</span>
                              <span class="order-number"><%= Spree::Order.human_attribute_name(:number) %>: <%= link_to order.number, order_url(order) %></span>
                            </td>
                          </tr>
                          <tr>

                            <td class="order-info" colspan="3">
                              <% order.line_items.each do |item| %>
                                <div class="order-product-item clearfix">
                                  <div class="pull-left" data-hook="order_item_image">
                                    <% if item.variant.images.length == 0 %>
                                      <%= link_to small_image(item.variant.product), item.variant.product, class: 'account-order-image' %>
                                    <% else %>
                                      <%= link_to image_tag(item.variant.images.first.attachment.url(:small)), item.variant.product, class: 'account-order-image' %>
                                    <% end %>
                                  </div>
                                  <div class="order-item-desc pull-left" data-hook="order_item_description">
                                    <p class="product-name"><%= item.variant.product.name %></p>
                                    <p class="product-variant"><%= item.variant.options_text unless item.variant.option_values.empty? %></p>
                                  </div>
                                  <div data-hook="order_item_qty" class="text-center order-qty pull-right"><%= item.quantity %></div>
                                  <div data-hook="order_item_price" class="text-center order-item-price pull-right"><span><%= item.single_money.to_html %></span></div>
                                </div>
                              <% end %>
                            </td>
                            <td class="text-center order-total"><%= order.display_total %></td>
                            <td class="text-center order-status">
                              <p class="hidden"><%= Spree.t("order_state.#{order.state}").titleize %></p>
                              <p class="order-payment-state"><%= Spree.t("payment_states.#{order.payment_state}").titleize if order.payment_state %></p>
                              <p><%= link_to '订单详情', order_url(order) %></p>
                            </td>
                            <td class="order-operations text-center">取消订单</td>

                          </tr>
                        </tbody>
                      <% end %>
                    <% end %>
                  </table>
                <% else %>
                  <div class="alert alert-info"><%= Spree.t(:you_have_no_orders_yet) %></div>
                <% end %>
                <br />
              </div>
            </div>
          </div>
        </div>

      </div>

      <!------------------------- Account ---------------------------------->

      <div class="tab-pane fade <%= 'active in' if params[:tab] == 'account_summary' %>" id="account_summary">
        <%= render partial: "account_summary" %>
      </div>

      <div class="tab-pane fade <%= 'active in' if params[:tab] == 'wishlist' %>" id="wishlist">
        <div data-hook="account_my_wishlist" class="account-my-wishlist"></div>
      </div>
      <div class="tab-pane fade <%= 'active in' if params[:tab] == 'address' %>" id="address">
        <div data-hook="account_my_address" class="account-my-address"></div>
      </div>
    </div>
  </div>
</div>
